<!---
* User Detail Page Email and Date of Birth field refractors
* @author Ayush Prajapati <aprajapati1@sheffield.ac.uk>
*/
---->

<div class="row mt-3">
    <div class="col-md-12">
        <h2 class="fw-semibold">
            <span>
                <a href="/admin/accounts" class="text-decoration-none">
                    <i class="fa-solid fa-arrow-left text-dark"></i>
                </a>
            </span>
            <span class="fa-stack">
                    <i class="fa-solid fa-stack-2x fa-square"></i>
                    <i class="fa-solid fa-stack-1x fa-user text-white"></i>
            </span>
            User Details
        </h2>
    </div>
</div>

<form method="POST" name="userPermissions" action="/admin/accounts/<%= userDetails._id %>">
    <div class="row mb-3">
        <div class="col-md-12">
            <div class="card rounded-4 shadow-sm">
                <div class="card-body">
                    <!--        <form method="POST" name="editUserDetails" class="w-100">-->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="mt-3 me-auto ms-auto">
                                <img src="https://ui-avatars.com/api/?name=<%= userDetails.first_name + " " + userDetails.last_name %>"
                                     class="me-auto ms-auto d-block rounded-circle" alt="Avatar"
                                     style="max-width: 150px;">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <h4 class="text-center mt-4 mb-3">Basic details</h4>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="row">
                                <label for="id" class="visually-hidden">User ID: </label>
                                <input name="id" type="hidden" id="userId" class="form-control"
                                       value="<%= userDetails._id %>"/>
                            </div>

                            <div class="row">
                                <div class="col-md-6 pe-1">
                                    <div class="form-floating">
                                        <input name="firstName" id="firstName" class="form-control"
                                               value="<%= userDetails.first_name %>"/>
                                        <label for="firstName" class="">First Name: </label>
                                    </div>
                                </div>

                                <div class="col-md-6 ps-1">
                                    <div class="form-floating">
                                        <input name="lastName" id="lastName" class="form-control"
                                               value="<%= userDetails.last_name %>"/>
                                        <label for="lastName" class="">Last Name: </label>
                                    </div>
                                </div>
                            </div>


                            <div class="form-floating">
                                <%
                                const dob = userDetails.date_of_birth instanceof Date ? userDetails.date_of_birth.toLocaleDateString('en-GB', {
                                    month: 'numeric',
                                    day: 'numeric',
                                    year: 'numeric'
                                }) : userDetails.date_of_birth;
                                %>
                                <label for="date_of_birth"></label><input name="date_of_birth" id="date_of_birth"
                                                                          class="form-control"
                                                                          value="<%= dob %>"/>
                                <label for="date_of_birth" class="d-inline-block w-25">Date of Birth: </label>
                            </div>
                            <hr class="w-100 text-center ms-auto me-auto pl-1 pr-1 mt-3 mb-1"/>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-12">
            <div class="card rounded-4 shadow-sm">
                <div class="card-body">
                    <div class="row">
                        <h4 class="fs-5 fw-bold mb-3">
                            <i class="fa-solid fa-map-location"></i>
                            Address & Contact Information
                        </h4>
                        <div class="d-flex w-100 flex-column ps-4 pe-4 pt-3 pb-1">
                            <div class="row">
                                <label for="email" class="d-inline-block w-25">Email: </label>
                                <% if (isGoogleAuthenticated) { %>
                                    <!-- Render Google logo -->
                                    <input name="email" id="email"
                                           class="d-inline-block w-50 form-control bg-dark-subtle"
                                           readonly
                                           value="<%= userDetails?.email %>"/>
                                    <span class="input-group-append mx-2">
                                        <i class="fa-brands fa-google"></i>
                                        <small>Google Account</small>
                                    </span>
                                <% } else { %>
                                    <!-- Remove the readonly attribute -->
                                    <input name="email" id="email" class="d-inline-block w-50 form-control"
                                           value="<%= userDetails?.email %>"/>
                                <% } %>
                            </div>

                            <hr class="w-100 text-center ms-auto me-auto pl-1 pr-1 mt-3 mb-3"/>
                            <div class="row">
                                <label for="phone" class="d-inline-block w-25">Telephone: </label>
                                <input name="phone" id="phone" class="d-inline-block w-50 form-control"
                                       value="<%= userDetails.phone_number %>"/>
                            </div>
                            <hr class="w-100 text-center ms-auto me-auto pl-1 pr-1 mt-3 mb-3"/>

                            <div class="row">
                                <label for="addressFirst" class="d-inline-block w-25">Address Line 1: </label>
                                <input name="addressFirst" id="addressFirst" class="d-inline-block w-50 form-control"
                                       value="<%= userDetails.address?.address_1 %>"/>
                            </div>
                            <hr class="w-100 text-center ms-auto me-auto pl-1 pr-1 mt-3 mb-3"/>

                            <div class="row">
                                <label for="addressSecond" class="d-inline-block w-25">Address Line 2: </label>
                                <input name="addressSecond" id="addressSecond" class="d-inline-block w-50 form-control"
                                       value="<%= userDetails.address?.address_2 %>"/>
                            </div>
                            <hr class="w-100 text-center ms-auto me-auto pl-1 pr-1 mt-3 mb-3"/>

                            <div class="row">
                                <label for="postCode" class="d-inline-block w-25">Post Code: </label>
                                <input name="postCode" id="postCode" class="d-inline-block w-50 form-control"
                                       value="<%= userDetails.address?.postcode %>"/>
                            </div>
                            <hr class="w-100 text-center ms-auto me-auto pl-1 pr-1 mt-3 mb-3"/>

                            <div class="row">
                                <label for="city" class="d-inline-block w-25">City: </label>
                                <input name="city" id="city" class="d-inline-block w-50 form-control"
                                       value="<%= userDetails.address?.city %>"/>
                            </div>
                            <hr class="w-100 text-center ms-auto me-auto pl-1 pr-1 mt-3 mb-3"/>

                            <div class="row">
                                <label for="country" class="d-inline-block w-25">Country: </label>
                                <input name="country" id="country" class="d-inline-block w-50 form-control"
                                       value="<%= userDetails.address?.country %>"/>
                            </div>

                            <hr class="w-100 text-center ms-auto me-auto pl-1 pr-1 mt-3 mb-3"/>

                            <div class="row">
                                <label for="role" class="d-inline-block w-25">Role: </label>
                                <select name="role" id="role" class="d-inline-block w-50 form-control">
                                    <option value="0" <%= userDetails.role === 0 ? 'selected' : '' %>>USER</option>
                                    <option value="1" <%= userDetails.role === 1 ? 'selected' : '' %>>STAFF</option>
                                    <option value="2" <%= userDetails.role === 2 ? 'selected' : '' %>>ADMIN</option>
                                </select>
                            </div>
                            <hr class="w-100 text-center ms-auto me-auto pl-1 pr-1 mt-3"/>
                        </div>
                    </div>


                    <div class="row">
                        <div class="mt-2 d-flex align-items-center justify-content-between mt-3">
                            <button class="btn btn-primary w-100" type="submit">Save details</button>
                            <button class="btn btn-danger ms-3 w-100" type="button" id="deleteUser">Delete User</button>
                            <% if (userDetails.active) { %>
                                <button class="btn btn-danger ms-3 w-100" type="button" id="deactivateUser">Deactivate
                                    User
                                </button>
                            <% } else { %>
                                <button class="btn btn-success ms-3 w-100" type="button" id="activateUser">Activate User
                                </button>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card rounded-4 shadow-sm">
                <div class="card-body">
                    <div class="row">
                        <!--        </form>-->
                        <h4 class="fw-bold fs-5 mb-3">
                            <i class="fa-solid fa-mobile-screen"></i>
                            Owned Items
                        </h4>
                        <div class="d-flex w-100 ps-3 pe-3 pt-3 pb-3">
                            <div class="container-fluid text-center">
                                <div class="row mb-2">
                                    <div class="col-sm fw-bold ">Item ID:</div>
                                    <div class="col fw-bold ">Item Name</div>
                                    <div class="col-sm fw-bold ">Details Page</div>
                                    <div class="col-sm fw-bold ">Status</div>
                                </div>
                                <hr class="w-100"/>
                                <% userDetails.listed_devices?.forEach( item => {
                                    const statusStyle = item.state === "Approved" ? "btn-success" : "btn-warning";
                                %>
                                <div class="row mb-3">
                                    <div class="col-sm"><%= item._id %></div>
                                    <div class="col"><%= item.brand?.name + " " + item.model?.name %></div>
                                    <div class="col-sm"><a class="btn btn-primary w-100"
                                                           href="<%= item._id %>">Details</a>
                                    </div>
                                    <div class="col-sm">
                                        <div class="btn <%= statusStyle %> w-100"><%= item.state %></div>
                                    </div>
                                </div>
                                <% }) %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<script src="/javascripts/accountManagement/accountManagement.js"></script>